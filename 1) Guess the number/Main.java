// Импорт необходимых классов из стандартной библиотеки Java
import java.util.Random;   // Для генерации случайных чисел
import java.util.Scanner;  // Для чтения ввода пользователя с клавиатуры

// Объявление главного класса программы
public class Main {

    // Главный метод - точка входа в программу
    public static void main(String[] args) {

        // СОЗДАНИЕ ОСНОВНЫХ ОБЪЕКТОВ И ПЕРЕМЕННЫХ

        // Создаем объект Scanner для чтения ввода пользователя
        // System.in - стандартный поток ввода (клавиатура)
        Scanner scanner = new Scanner(System.in);

        // Создаем объект Random для генерации случайных чисел
        Random random = new Random();

        // Переменная-флаг для отслеживания желания пользователя играть снова
        // true - играть еще, false - завершить игру
        boolean playAgain = true;

        // СТАТИСТИКА ИГРЫ

        // Счетчик побед - увеличивается когда игрок угадывает число
        int wins = 0;

        // Счетчик поражений - увеличивается когда у игрока заканчиваются попытки
        int losses = 0;

        // Лучший результат (минимальное количество попыток для угадывания)
        // Integer.MAX_VALUE - специальное значение для инициализации (2147483647)
        int bestScore = Integer.MAX_VALUE;

        // ВЫВОД ПРИВЕТСТВЕННОГО СООБЩЕНИЯ
        System.out.println("**********************************");
        System.out.println("*      GUESS THE NUMBER GAME     *");
        System.out.println("**********************************");

        // ОСНОВНОЙ ЦИКЛ ПРОГРАММЫ - выполняется пока playAgain = true
        while (playAgain) {

            // ВЫБОР УРОВНЯ СЛОЖНОСТИ

            System.out.println("\n--- Выбери уровень сложности ---");
            System.out.println("1 - Легкий (1-50, 10 попыток)");
            System.out.println("2 - Средний (1-100, 7 попыток)");
            System.out.println("3 - Сложный (1-200, 5 попыток)");
            System.out.print(">>> Твой выбор: ");

            // Чтение выбора сложности от пользователя
            // nextInt() читает целое число из ввода
            int difficulty = scanner.nextInt();

            // Объявление переменных для хранения настроек сложности
            int maxAttempts;  // Максимальное количество попыток
            int maxRange;     // Максимальное значение загадываемого числа

            // ОПРЕДЕЛЕНИЕ НАСТРОЕК СЛОЖНОСТИ ЧЕРЕЗ SWITCH

            // Конструкция switch - альтернатива нескольким if-else
            switch (difficulty) {
                case 1:
                    // Легкий уровень: большой диапазон попыток, маленький диапазон чисел
                    maxAttempts = 10;
                    maxRange = 50;
                    break;  // Выход из switch

                case 2:
                    // Средний уровень: баланс между попытками и диапазоном
                    maxAttempts = 7;
                    maxRange = 100;
                    break;

                case 3:
                    // Сложный уровень: мало попыток, большой диапазон чисел
                    maxAttempts = 5;
                    maxRange = 200;
                    break;

                default:
                    // Выполняется если ни один case не совпал (не 1, не 2, не 3)
                    System.out.println("[!] Неверный выбор. Ставлю средний уровень.");
                    maxAttempts = 7;
                    maxRange = 100;
            }

            // ПОДГОТОВКА К НОВОЙ ИГРЕ

            // Генерация случайного числа от 1 до maxRange
            // nextInt(maxRange) дает число от 0 до maxRange-1, поэтому +1
            int numberToGuess = random.nextInt(maxRange) + 1;

            // Счетчик использованных попыток для текущей игры
            int attempts = 0;

            // Флаг угадывания - true если игрок угадал число
            boolean guessed = false;

            // ИНФОРМАЦИЯ О НАЧАЛЕ ИГРЫ
            System.out.println("\n>>> Я загадал число от 1 до " + maxRange);
            System.out.println(">>> У тебя " + maxAttempts + " попыток!");

            // ОСНОВНОЙ ИГРОВОЙ ЦИКЛ
            // Выполняется пока есть попытки И число не угадано
            while (attempts < maxAttempts && !guessed) {

                // Запрос числа от пользователя
                System.out.print("\nПопытка " + (attempts + 1) + "/" + maxAttempts + ": ");
                int guess = scanner.nextInt();  // Чтение предположения игрока
                attempts++;  // Увеличение счетчика попыток на 1

                // ПРОВЕРКА ПРЕДПОЛОЖЕНИЯ ИГРОКА

                if (guess < numberToGuess) {
                    // Если предположение меньше загаданного числа
                    System.out.println(">>> Мое число БОЛЬШЕ");
                } else if (guess > numberToGuess) {
                    // Если предположение больше загаданного числа
                    System.out.println(">>> Мое число МЕНЬШЕ");
                } else {
                    // Если предположение равно загаданному числу - ПОБЕДА!
                    System.out.println("[+] ПОЗДРАВЛЯЮ! Ты угадал за " + attempts + " попыток!");
                    guessed = true;  // Устанавливаем флаг угадывания
                    wins++;          // Увеличиваем счетчик побед

                    // ПРОВЕРКА НА НОВЫЙ РЕКОРД
                    if (attempts < bestScore) {
                        bestScore = attempts;  // Обновляем лучший результат
                        System.out.println("[!] НОВЫЙ РЕКОРД!");
                    }
                }

                // СИСТЕМА ПОДСКАЗОК

                // Подсказка на 3-й попытке (если еще не угадал)
                if (attempts == 3 && !guessed) {
                    System.out.println("[?] Подсказка: используй стратегию деления пополам!");
                }
                // Подсказка на 5-й попытке (если еще не угадал)
                else if (attempts == 5 && !guessed) {
                    // Проверка четности загаданного числа
                    // % - оператор остатка от деления
                    if (numberToGuess % 2 == 0) {
                        System.out.println("[?] Подсказка: число ЧЕТНОЕ");
                    } else {
                        System.out.println("[?] Подсказка: число НЕЧЕТНОЕ");
                    }
                }
            }

            // ОБРАБОТКА ПОРАЖЕНИЯ
            // Если вышли из цикла и не угадали (закончились попытки)
            if (!guessed) {
                System.out.println("[-] Увы! Загаданное число было: " + numberToGuess);
                losses++;  // Увеличиваем счетчик поражений
            }

            // МАССИВ СОВЕТОВ ПОСЛЕ ИГРЫ

            // Объявление и инициализация массива строк с советами
            String[] tips = {
                    "[?] Совет: начинай с середины диапазона",
                    "[?] Совет: запоминай введенные числа",
                    "[?] Совет: сужай диапазон после каждой попытки",
                    "[?] Совет: используй информацию 'больше/меньше'",
                    "[?] Совет: на сложном уровне будь точнее в расчетах",
                    "[?] Совет: не повторяй одни и те же числа"
            };

            // Выбор и вывод случайного совета
            // random.nextInt(tips.length) дает случайный индекс от 0 до длины массива-1
            System.out.println("\n" + tips[random.nextInt(tips.length)]);

            // ВЫВОД СТАТИСТИКИ ТЕКУЩЕЙ СЕССИИ

            System.out.println("\n=================================");
            System.out.println("           СТАТИСТИКА");
            System.out.println("=================================");
            System.out.println("[+] Победы: " + wins + " | [-] Поражения: " + losses);

            // Расчет и вывод процента побед
            // Проверяем что была хотя бы одна игра
            if (wins + losses > 0) {
                // (double) - приведение к дробному числу для точного деления
                double winRate = (double) wins / (wins + losses) * 100;
                // printf - форматированный вывод, %.1f%% - дробное число с 1 знаком после запятой и символ %
                System.out.printf("[%%] Процент побед: %.1f%%\n", winRate);
            }

            // Вывод лучшего результата (если была хотя бы одна победа)
            if (bestScore != Integer.MAX_VALUE) {
                System.out.println("[!] Лучший результат: " + bestScore + " попыток");
            }

            // ЗАПРОС НА ПОВТОРНУЮ ИГРУ

            System.out.print("\n>>> Хочешь сыграть еще раз? (да/нет): ");
            // next() читает следующее слово из ввода
            String answer = scanner.next();

            // Проверка ответа пользователя (игнорируя регистр)
            playAgain = answer.equalsIgnoreCase("да") ||
                    answer.equalsIgnoreCase("yes") ||
                    answer.equalsIgnoreCase("y") ||
                    answer.equalsIgnoreCase("д");
        }

        // ЗАВЕРШЕНИЕ ПРОГРАММЫ

        // Закрытие Scanner для освобождения ресурсов
        scanner.close();

        // Финальное сообщение и статистика
        System.out.println("\n*** Спасибо за игру! ***");
        System.out.println("Итог: " + wins + " побед, " + losses + " поражений");

        // Вывод лучшего результата если были победы
        if (bestScore != Integer.MAX_VALUE) {
            System.out.println("Лучший результат: " + bestScore + " попыток");
        }
    }
}
